BASIC MCS 8080	GATES/ALLEN/DAVIDOFF	MACRO	47(113)	03:12 10-SEP-75	PAGE 8-4
F3	MAC	 06-SEP-64 03:11	ERROR HANDLER, READY, COMPACTIFICATION, NEW, CLEAR, MAIN
	
  2078	002315'	001000	000257		30660		XRA	A		;SEARCHING FOR A ZERO IN MEMORY
  2079	002316'	001000	000276		30680	CZLOOP:	CMP	M		;TO MARK THE END OF THIS LINE
  2080	002317'	001000	000043		30700		INX	H		;BUMP POINTER
  2081	002320'	001000	000302		30720		JNZ	CZLOOP		;END OF LINE
  2082	002321'	000000	002316'		
  2083	002322'	000000	002310'		
  2084	002323'	001000	000353		30740		XCHG			;SWITCH TEMP
  2085	002324'	001000	000163		30760		MOV	M,E		;DD FIRST BYTE OF FIXUP
  2086	002325'	001000	000043		30780		INX	H		;ADVANCED POINTER
  2087	002326'	001000	000162		30800		MOV	M,D		;2ND BYTE OF FIXUP
  2088	002327'	001000	000353		30820		XCHG			;AND BACK AGAIN
  2089	002330'	001000	000303		30840		JMP	CHEAD		;KEEP CHAINING TILL DONE
  2090	002331'	000000	002302'		
  2091	002332'	000000	002321'		
  2092					30860	IFE	LENGTH-2<
  2093					30880	;
  2094					30900	; SCNLI SCNS A LINE RANGE OF
  2095					30920	; THE FOR #-# OR # OR #- OR -# OR BLANK
  2096					30940	; AND THEN FIND THE FIRST LINE IN THE RANGE
  2097					30960	;
  2098	002333'	001000	000021		30980	SCNLIN:	LX1	D,$CODE		;ASSUME LIST AT ZERO
  2099	002334'	000000	000000'		
  2100	002335'	000000	002331'		
  2101	002336'	001000	000325		31000		PUSH	D		;SAVE INITIAL ASSUMPTION
  2102	002337'	001000	000312		31020		JZ	ALLST		;IF FINISHED, LIST IT ALL
  2103	002340'	000000	002354'		
  2104	002341'	000000	002334'		
  2105	002342'	001000	000321		31040		POP	D		;WE ARE GOING TO GRAB A #
  2106	002343'	001000	000215		31060		CALL	LINGET		;GET A LINE #, IF NONE, RETURNS ZERO
  2107	002344'	000000	003642'		
  2108	002345'	000000	002340'		
  2109	002346'	001000	000325		31080		PUSH	D		;SAVE FIRST
  2110	002347'	001000	000213		31100		JZ	ONELIN		;IF ONLY # THEN DONE.
  2111	002350'	000000	002365'		
  2112	002351'	000000	002344'		
  2113	002352'	001000	000317		31120		SYNCHK	MINUTK		;MUST BE DASH.
  2114	002353'	000000	000251		
  2115	002354'	001000	000021		31140	ALLLST:	LXI	D,$CODE+^065529	; ASSUME MAX END OF RANGE
  2116	002355'	000000	177771'		
  2117	002356'	000000	002350'		
  2118	002357'	001000	000304		31160		CNZ	LINGET		;GET THE END OD RANGE
  2119	002360'	000000	003642'		
  2120	002361'	000000	002355'		
  2121	002362'	001000	000302		31180		JNX	SNERR		;MUST BE TERMINATOR
  2122	002363'	000000	002072'		
  2123	002364'	000000	002360'		
  2124	002365'	001000	000353		31200	ONELIN:	XCHG			;(H,L) = FINAL
  2125	002366'	001000	000321		31220		POP	D		;GET INITIAL IN (D,E)
  2126	002367'	001000	000343		31240		XTHL			;PUT MAX ON STACK, RETURN ADDR TO (H,L)
  2127	002370'	001000	000345		31260		PUSH	H>		;SAVE RETURN ADDRESS BACK
  2128					31280	;
  2129					31300	; FNDLIN SEARCHES THE PROGRAM TEXT FOR THE LINE
  2130					31320	; WHOSE LINE # IS PASSED IN (D,E), (D,E) IS PRESERVED.

