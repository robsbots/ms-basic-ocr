MATHPK FOR BASIC MCS 8080  GATES/ALLEN/DAVIDOFF MARCO 47(113) 06:09 27-AUG-75 PAGE 13-1
f4	MAC	23-AUG-64 06:08		FLOATING POINT OUTPUT ROUTINE

	2752	002012'	000000	002002'	
	2753	002013'	001000	000066		46260		MVI	N,"-"		;PRINT A MINUS SIGN IF NEGATIVE
	2754	002014'	000000	000055
	2755	002015'	001000	000043		46280	FOUT1:	INX	H		;INCREMENT POINTER TO NEXT CHARACTER POSITION
	2756	002016'	001000	000066		46300		MVI	M,"0"		;PUT A ZERO IN BUFFER INCASE NUMBER=0
	2757	002017'	000000	000060
	2758	002020'	001000	000312		46320		JZ	FOUT19		;DO IT IF THE NUMBER IS ZERO
	2759	002021'	000000	002266'
	2760	002022'	000000	002011'
	2761	002023'	001000	000345		46340		PUSH	H		;SAVE BUFFER POINTER
	2762	002024'	001000	000374		46360		CM	NEG		;NEGATE NUMBER IF NEGATIVE
	2763	002025'	000000	0001175'
	2764	002026'	000000	002021'
	2765
	2766					46400	;HERE WE GET THE FAC IN THE RANGE 100000 .LE. FAC .LE. 999999 AND ROUND IT TO
	2767					46420	;AN INTEGER. WE KEEP A COUNT OF HOW MANY TIMES WE MULTIPLY OR DIVIDE BY TEN
	2768					46440	;SO WE KNOW WHAT THE EXPONENT WILL BE. THE FAC IS THEN CONVERTED TO AN
	2769					46460	;INTEGER IN C,D,E WE USE A TABLE OF POWERS OF TEN TO CALCULATE EACH DIGIT,
	2770					46480	;THIS ALGORITHM IS USED FOR SPEED,
	2771	002027'	001000	000257		46500		XRA	A		;PUT TEN'S EXPONENT COUNT ON STACK
	2772	002030	001000	000365		46520		PUSH	PSW
	2773	002031'	001000	000315		46540		CALL	FOUTCB		;SEE IF NUMBER IS TOO BIG OR TOO SMALL
	2774	002032'	000000	002274'
	2775	002033'	000000	002025'
	2776	002034'	001000	000001		46560	FOUT3:	MOVRI	221,103,117,370	;IS NUMBER .LE. 99999.9499? IT IS TOO SMALL
	2777	002035'	000000	000103
	2778	002036'	000000	000221
	2779	002037'	001000	000021
	2780	002040'	000000	000370
	2781	002041'	000000	000117
	2782	002042'	001000	000315		46580		CALL	FCOMP		;FCOMP RETURNS 377, 0 OR 1 IN A SO THE		
	2783	002043'	000000	001317'
	2784	002044'	000000	002032'
	2785					46600					; PARITY WILL BE ODD IFF 1 IS RETURNED
	2786	002045'	001000	000342		46620		JPO	FOUT5		;NO, NUMBER IS IN RANGE
	2787	002046'	000000	002071'
	2788	002047'	000000	002034'
	2789	002050'	001000	000361		46640		POP	PSW
	2790	002051'	001000	000315		46660		CALL	FINMLT		;YES, MULTIPLY IT BY TEN TO GET
	2791	002052'	000000	001673'		
	2792	002053'	000000	002046'		
	2793	002054'	001000	000365		46680		PUSH	PSW		; IT IN RANGE
	2794	002055'	001000	000303		46700		JMP	FOUT3		;SEE IF NUMBER IS NOW IN RANGE
	2795	002056'	000000	002034'		
	2796	002057'	000000	002052'		
	2797	002060'	001000	000315		46720	FOUT9:	CALL	DIV10		;NO, DIIDE NUMBER BY TEN, IT IS TOO BIG
	2798	002061'	000000	000637'		
	2799	002062'	000000	002056'		
	2800	002063'	001000	000361		46740		PDP	PSW		;ADD ONE TP EXPONENT
	2801	002064'	001000	000074		46760		INR	A
	2802	002065'	001000	000365		46780		PUSH	PSW
	2803	002066'	001000	000315		46800		CALL	FOUTCB		;IS NUMBER .LE. 999999.499?
	2804	002067'	000000	00274'	
	
