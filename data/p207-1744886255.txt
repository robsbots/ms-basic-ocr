MATHPK FOR BASIC MCS 8008 GATES/ALLEN/DAVIDOFF MACRO 47(1113) 06:09 27-AUG-75 PAGE 2-4
F4	MAC	23-AUG-64 06:08		FLOATING POINT ADDITION AND SUBTRACTION

	389	000212'	000000	000175'			
	390	000213'	001000	000170		05280		MOV	A,B		;ALL NORMALIZED, GET SHIFT COUNT
	391	000214'	001000	000134		05300		MOV	E,H		;PUT LO'S BACK IN E,B
	392	000215'	001000	000105		05320		MOV	G,L		
	393	000216'	001000	000267		05340		ORA	A		;CHECK IF WE DID NO SHIFTING
	394	000217'	001000	000312		05360		JZ	ROUND>
	395	000220'	000000	000233'		
	396	000211'	000000	000211'		
	397	000222'	001000	000041		05380		LXI	M,HAC		;LOOK AT FAC'S EXPONENT
	398	000223'	000000	000175*		
	399	000234'	000000	000220'		
	400	000225'	001000	000206		05400		ADD	M		;UPDATE EXPONENT
	401	000226'	001000	000167		05420		MOV	M,A
	402	000227'	001000	000322		05440		JNC	ZERO		;CHECK FOR UNDERFLOW
	403	000230'	000000	000173'		
	404	000231'	000000	000223'		
	405	000232'	001000	000310		05460		RZ			;NUMBER IS ZERO, ALL DONE
	406					05480					;FALL INTO ROUND AND WE ARE DONE
	407
	408
	409					05540	;ROUND RESULT IN C,D,E,B AND PUT NUMBER IN THE FAC
	410					05560	;ALTERS A,B,C,D,E,H,L
	411					05580	;WE ROUND C,D,E UP OR DOWN DEPENDING UPON THE MSB OF B
	412	000233'	001000	000170		05600	ROUND:	MOV	A,B		;SEE IF WE SHOULD ROUND UP
	413	000234'	001000	000041		05620	ROUNDB:	LXI	H,FAC		;ENTRY FROM FDIV, GET POINTER TO EXPONENT
	414	000235'	000000	000223*
	415	000236'	000000	000230'
	416	000237' 001000	000267		05640		ORA	A	
	417	000240'	001000	000374		05660		CM	ROUNDa		;DO IT IF NECESSARY
	418	000241'	000000	000255'	
	419	000242'	000000	000235'
	420	000243' 001000	000106		05680		MOV	B,M		;PUT EXPONENT IN B
	421					05700		;HERE WE PACK THE HO AND SIGN
	422	000224'	001000	000043		05720		INX	H		;POINT TO SIGN
	423	000245'	001000	000176		05740		MOV	A,M		;GET SIGN
	424	000246'	001000	000346		05760		ANI	200		;GET RID OF UNWANTED BITS
	425	000247'	000000	000200		
	426	000250'	001000	000251		05780		XRA	C		;PACK SIGN AND HO
	427	000251'	001000	000117		05800		MOV	C,A		;SAVE IT IN C
	428	000252'	001000	000303		05820		JMP	MOVFR		;SAVE NUMBER IN FAC
	429	000253'	000000	001225'		
	430	000254'	000000	000241'		
	431	
	432	
	433					05880	IFE	LENGTH,<	
	434					05900		;SHIFT C,D,E LEFT ONE
	435					05920		;THIS IS USED BY NORMAL, FDIV
	436					05940		;ALTERS A,C,D,E
	437					05960	SHFTLO:	MOV	A,E		;GET THE LO
	438					05980		RAL			;SHIFT IT
	439					06000		MOVE	E,A		;SAVE IT
	440					06020		MOVE A,O		;SHIFT THE NEXT HIGHER OERDER
	441					06040		RAL
	
